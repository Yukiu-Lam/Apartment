---
title: "My title"
subtitle: "My subtitle if needed"
author: 
  - Yuqiao Lin
thanks: "Code and data are available at: LINK."
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
output:
  bookdown::pdf_document2
toc: FALSE
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tinytex.verbose = TRUE)
library(plyr)
library(tidyverse)
library(tidyr)
library(dplyr)
library(knitr)
library(tinytex)
library(usethis)
```

# Introduction

You can and should cross-reference sections and sub-sections. For instance, Section \@ref(data). R Markdown automatically makes the sections lower case and adds a dash to spaces to generate labels, for instance, Section \@ref(first-discussion-point). 



# Data

Our data is of penguins (Figure \@ref(fig:bills)).

```{r, dataextract, echo=FALSE, warning=FALSE, message=FALSE}
Apartment_evaluation <-
  read_csv(here::here("inputs/data/Apartment_Evaluation.csv"))
options(warn=-1)

cleaned_data <- Apartment_evaluation |>
  select(WARDNAME, YEAR_BUILT, CONFIRMED_STOREYS, CONFIRMED_UNITS, SCORE) |>
  filter(WARDNAME == "Toronto Centre" | WARDNAME == "Spadina-Fort York" | WARDNAME == "University-Rosedale") |>
  mutate(UNITS_PER_STOREYS = CONFIRMED_UNITS / CONFIRMED_STOREYS) |>
  drop_na() |>
  filter(YEAR_BUILT >= 1950) 

until_1955 <- cleaned_data |>
  filter(YEAR_BUILT >= 1950 & YEAR_BUILT< 1955)
until_1960 <- cleaned_data |>
  filter(YEAR_BUILT >= 1955 & YEAR_BUILT< 1960)
until_1965 <- cleaned_data |>
  filter(YEAR_BUILT >= 1960 & YEAR_BUILT< 1965)
until_1970 <- cleaned_data |>
  filter(YEAR_BUILT >= 1965 & YEAR_BUILT< 1970)
until_1975 <- cleaned_data |>
  filter(YEAR_BUILT >= 1970 & YEAR_BUILT< 1975)
until_1980 <- cleaned_data |>
  filter(YEAR_BUILT >= 1975 & YEAR_BUILT< 1980)
until_1985 <- cleaned_data |>
  filter(YEAR_BUILT >= 1980 & YEAR_BUILT< 1985)
until_1990 <- cleaned_data |>
  filter(YEAR_BUILT >= 1985 & YEAR_BUILT< 1990)
until_1995 <- cleaned_data |>
  filter(YEAR_BUILT >= 1990 & YEAR_BUILT< 1995)
until_2000 <- cleaned_data |>
  filter(YEAR_BUILT >= 1995 & YEAR_BUILT< 2000)
until_2005 <- cleaned_data |>
  filter(YEAR_BUILT >= 2000 & YEAR_BUILT< 2005)
until_2010 <- cleaned_data |>
  filter(YEAR_BUILT >= 2005 & YEAR_BUILT< 2010)
until_2015 <- cleaned_data |>
  filter(YEAR_BUILT >= 2010 & YEAR_BUILT< 2015)
until_2021 <- cleaned_data |>
  filter(YEAR_BUILT >= 2015 & YEAR_BUILT< 2021)



Average_year <- c(median(until_1955$SCORE),
                  median(until_1960$SCORE),
                  median(until_1965$SCORE),
                  median(until_1970$SCORE),
                  median(until_1975$SCORE),
                  median(until_1980$SCORE),
                  median(until_1985$SCORE),
                  median(until_1990$SCORE),
                  median(until_1995$SCORE),
                  median(until_2000$SCORE),
                  median(until_2005$SCORE),
                  median(until_2010$SCORE),
                  median(until_2015$SCORE),
                  median(until_2021$SCORE)
                  )
  
Year_in_5 <- c(1955, 1960, 1965, 1970, 1975, 1980, 1985, 1990, 1995, 2000, 2005, 2010, 2015, 2021)
Average_score <- data.frame(Year_in_5, Average_year)

```


```{r Age, fig.cap="Builded year distributino in three wards", echo = FALSE}
cleaned_data |> 
  ggplot(mapping = aes(x = YEAR_BUILT, group = WARDNAME, fill = WARDNAME)) +
  geom_histogram(method = 'histodot', alpha = 0.4, bins = 50) +
  theme_minimal() +
  labs(x = "Builded Year",
       y = "Number of Apartment",
       fill = "WARD",
       caption = "Data source: OPEN DATA TORONTO.") +
  scale_color_brewer(palette = "Set3") +
  theme(legend.position = "bottom")
```

Talk more about it.

Also bills and their average (Figure \@ref(fig:billssssss)). (Notice how you can change the height and width so they don't take the whole page?)

```{r}
Spadina_fort_York_data <- 
  cleaned_data |>
  filter(WARDNAME == "Spadina-Fort York")

Toronto_cerntre_data <- 
  cleaned_data |>
  filter(WARDNAME == "Toronto Centre")

University_Rosedale_data <- 
  cleaned_data |>
  filter(WARDNAME == "University-Rosedale")
```

```{r}
Spadina_fort_York_data |>
  ggplot(mapping = aes(x = YEAR_BUILT, y = SCORE)) +
  geom_jitter() +
  geom_point(alpha = 0.5) +
  theme_minimal() +
  labs(x = "Builded Year",
       y = "Score of the apartment",
       caption = "Data source: OPEN DATA TORONTO.") +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom")
```


```{r}
Toronto_cerntre_data |>
  ggplot(mapping = aes(x = YEAR_BUILT, y = SCORE)) +
  geom_jitter() +
  geom_point(alpha = 0.5) +
  theme_minimal() +
  labs(x = "Builded Year",
       y = "Score of the apartment",
       caption = "Data source: OPEN DATA TORONTO.") +
  theme(legend.position = "bottom")
```


```{r billssssss, fig.cap="More bills of penguins", echo = FALSE, fig.width=8, fig.height=4}
University_Rosedale_data |>
  ggplot(mapping = aes(x = YEAR_BUILT, y = SCORE)) +
  geom_jitter() +
  geom_point(alpha = 0.5) +
  theme_minimal() +
  labs(x = "Builded Year",
       y = "Score of the apartment",
       caption = "Data source: OPEN DATA TORONTO.") +
  theme(legend.position = "bottom")

```

Talk way more about it. 
```{r}
Average_score |>
  ggplot(mapping = aes(x = Year_in_5, y = Average_year)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Builded Year",
       y = "Score of the apartment",
       caption = "Data source: OPEN DATA TORONTO.")
```



# Model




Here's a dumb example of how to use some references: In paper we run our analysis in `R` [@citeR]. We also use the `tidyverse` which was written by @thereferencecanbewhatever If we were interested in baseball data then @citeLahman could be useful. 

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

# Discussion

## First discussion point

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional details


\newpage


# References


